services:
  - type: web
    name: riverflow-server
    runtime: docker
    region: singapore
    plan: free
    branch: docker-deploy
    
    # Docker configuration
    dockerfilePath: ./Dockerfile
    dockerContext: .
    
    # Environment variables
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      
      # Backend URL for file serving
      - key: APP_BACKEND_URL
        value: https://riverflow-server.onrender.com/api
      
      # Frontend URL for CORS
      - key: APP_FRONTEND_URL
        value: https://river-flow-client.vercel.app
      
      # Upload directory - must match the disk mount path
      - key: APP_UPLOAD_DIR
        value: /app/uploads/avatars
    
    # Persistent disk for file uploads
    disk:
      name: riverflow-uploads
      mountPath: /app/uploads
      sizeGB: 1
    
    # Health check
    healthCheckPath: /api/actuator/health
    
    # Auto-deploy on push
    autoDeploy: true

